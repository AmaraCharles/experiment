!function(){function e(e,t){for(var r in e){if(r.startsWith("__reactInternalInstance$")||r.startsWith("__reactFiber$")){res=e[r];try{if(e[r]._currentElement){var o=e[r]._currentElement,i=o._owner,a=i._instance;res=a}else if(e[r].child&&e[r].child.props&&"not_child"!==t)res=e[r].child;else if(e[r].child&&e[r].child.pendingProps&&"not_child"!==t)res=e[r].child;else if(e[r].pendingProps){var n=e[r].pendingProps.children._owner?e[r].pendingProps.children._owner.stateNode:e[r].pendingProps.children[0]&&e[r].pendingProps.children[0]._owner?e[r].pendingProps.children[0]._owner.stateNode:e[r].return.stateNode?e[r].return.stateNode:null;n&&(res=n)}else if(e[r].memoizedProps){var l=e[r].memoizedProps.children._owner?e[r].memoizedProps.children._owner.stateNode:e[r].memoizedProps.children[0]&&e[r].memoizedProps.children[0]._owner?e[r].memoizedProps.children[0]._owner.stateNode:e[r].return.stateNode?e[r].return.stateNode:null;l&&(res=l)}}catch(e){console.log(e)}return res}if(r.startsWith("__reactProps$")){res=e[r];try{if(e[r]._currentElement){o=e[r]._currentElement,i=o._owner,a=i._instance;res=a}else e[r].children&&e[r].children[0]&&e[r].children[0].props&&(res=e[r].children[0])}catch(e){console.log(e)}return res}}return null}function t(e){var t=e.csvToArray();return t}function r(e,t,r){var o;return function(){var i=this,a=arguments,n=function(){o=null,r||e.apply(i,a)},l=r&&!o;clearTimeout(o),o=setTimeout(n,t),l&&e.apply(i,a)}}function o(e,t){if(!document.getElementById(t)){var r=document.getElementsByTagName("head")[0],o=document.createElement("link");o.id=t,o.rel="stylesheet",o.type="text/css",o.href=e+"?cache="+ +((new Date).getTime()+"").substr(0,7),o.media="all",r.appendChild(o)}}function i(e,t,r){if(r=r||window,!r.document.getElementById(t)){var o=r.document.createElement("style");o.type="text/css",o.id=t,o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.document.createTextNode(e)),r.document.querySelectorAll("body")[0].appendChild(o)}}function a(e){e=e||window;var t=e.document.body;if(!e.SQSLayoutObserver&&t){var o=r(function(e){Y.Global.fire("SQSLayout:edit",{context:e})},2e3,!1);e.SQSLayoutObserver=new MutationObserver(function(t){t.forEach(function(t){"attributes"==t.type&&"class"===t.attributeName&&t.target.className&&t.target.className.indexOf&&t.target.className.length&&(t.target.className.indexOf("sqs-layout-rendering")>-1||t.target.className.indexOf("sqs-editing")>-1)&&o(e)})}),e.SQSLayoutObserver.observe(t,{childList:!0,subtree:!0,attributes:!0})}}function n(e){if(e.length){var t=Object.keys(e[0]),r=function(e,t){return null===t?"":t},o=e.map(function(e){return t.map(function(t){return JSON.stringify(e[t],r).replace(/\\"/g,'""')}).join(",")});return o.unshift("Title,Url,Excerpt,Categories,Tags,Marker Lat,Marker Lng,Image Url,Id,Address Line1"),o.join("\r\n")}return""}function l(e){var t=(new DOMParser).parseFromString(e,"text/xml"),r=[],o=[];if("kml"!=t.documentElement.nodeName)throw"error while parsing";var i=t.getElementsByTagName("Placemark");if(i)for(var a=i.length-1;a>=0;a--){var n=i[a],l=n.getElementsByTagName("name")[0]&&n.getElementsByTagName("name")[0].childNodes[0].nodeValue.trim(),s=n.getElementsByTagName("Polygon"),p=n.getElementsByTagName("Point"),c=n.parentNode,d=[],m=n.getElementsByTagName("description")&&n.getElementsByTagName("description")[0]&&n.getElementsByTagName("description")[0].innerHTML;if(console.log("Descr",[n.getElementsByTagName("description")],l,m),c&&"Folder"==c.tagName){var u=c.children[0]&&"name"==c.children[0].tagName&&c.children[0].textContent;u&&(d=u.replace(/,/g,"&#44;"))}s&&s.length&&[].forEach.call(s,function(e){var t=e.getElementsByTagName("coordinates")[0].childNodes[0].nodeValue.trim(),o=t.split(" "),i=[];for(var a in o){var n=a.split(",");i.push({lat:+n[1],lng:+n[0]})}r.push(i)}),p&&p.length&&[].forEach.call(p,function(e,t){var r=e.getElementsByTagName("coordinates")[0].childNodes[0].nodeValue.trim(),i=r.split(",");o.push({title:l.replace("<![CDATA[","").replace("]]>",""),url:"",excerpt:m.replace("<![CDATA[","").replace("]]>",""),categories:d,tags:"",markerLat:i[1],markerLng:i[0],imageUrl:"",id:a,addressLine1:""})})}return console.log(o,r),{markers:o,polygons:r}}function s(t,r,o){var i=o,a=t&&"new-dialog"==t,n=a?r:r.get("dialog");if(n.fields)n.fields.csvData.setValue(null);else try{if(i){var l=i.querySelector(".mapCSVData")||window.top.document.querySelector(".mapCSVData");l=l&&e(l);var s=l&&(l.props||l.pendingProps);s&&(l.onChange?l.onChange(null):s.onChange&&s.onChange(null))}else n.pendingProps.host.get("model").set("csvData",null)}catch(e){console.error(e)}}function d(e,t){try{var r=(e.props||e.pendingProps).host.get("model");if(r&&r.getAttrs){var o=r.getAttrs();o.snazzyUrl&&o.snazzyUrl.indexOf("https://snazzymaps.com/style/")>-1?fetch("https://tools.squarewebsites.org/api/get-snazzy-style/?url="+encodeURIComponent(o.snazzyUrl)).then(function(e){return e.text()}).then(function(e){var t=new DOMParser,i=t.parseFromString(e,"text/html"),a=i.querySelector("#style-json"),n=(i.title||"").split(" - ")[0];if(a&&a.textContent){var l="";try{l=JSON.parse(a.textContent),l&&l.length&&(o.snazzyData=JSON.stringify(l),o.snazzyName=n,r.setAttrs(o))}catch(e){console.log(e),o.snazzyData=null,o.snazzyName="",r.setAttrs(o),window.alert("We can not load your style, try another url")}}else o.snazzyData=null,o.snazzyName=null,r.setAttrs(o),window.alert("We can not load your style, try another url")}):(o.snazzyData=null,o.snazzyName=null,r.setAttrs(o))}}catch(e){console.log(e)}}function m(r,o,i,a,s){var p,c=i,d=r&&"new-dialog"==r,m=d?o:o.get("dialog"),u=function(){p&&(p.removeEventListener("change",h),p.parentNode&&p.parentNode.removeChild(p))},g=function(r){if(r=r.target?r.target.result.trim():r,r)try{var o="";if(r.indexOf("<kml")>-1?(o=l(r).markers,r=n(o)):o=t(r),o.length)if(m.fields)m.fields.csvData.setValue(r);else try{if(c){var i=c.querySelector(".mapCSVData")||window.top.document.querySelector(".mapCSVData");i=i&&e(i);var a=i&&(i.props||i.pendingProps);a&&(i.onChange?i.onChange(r):a.onChange&&a.onChange(r))}else m.props.host.get("model").set("csvData",r),console.log("here dialog.props")}catch(e){console.error(e)}else if(console.log("Empty data to parse"),new Y.Squarespace.Widgets.Alert({"strings.title":"Warning","strings.message":"Empty data to parse."}),m.fields)m.fields.csvData.setValue(null);else try{if(c){i=c.querySelector(".mapCSVData")||window.top.document.querySelector(".mapCSVData");i=i&&e(i);a=i&&(i.props||i.pendingProps);a&&(i.onChange?i.onChange(null):a.onChange&&a.onChange(null))}else m.props.host.get("model").set("csvData",null)}catch(e){console.error(e)}}catch(e){console.log(e),new Y.Squarespace.Widgets.Alert({"strings.title":"Warning","strings.message":"Empty data to parse."}),m.fields.csvData.setValue(null)}else console.log("Empty data to parse"),new Y.Squarespace.Widgets.Alert({"strings.title":"Warning","strings.message":"Empty data to parse."}),m.fields.csvData.setValue(null)},h=function(e){e=e.target.files;var t=new FileReader;t.onload=g,t.onabort=u,t.readAsText(e[0])};if(["File","FileReader","FileList","Blob"].every(function(e){return window[e]})){var f=document.createElement("input");f.setAttribute("type","file"),f.setAttribute("id","fileupload"),f.setAttribute("name","fileupload"),f.setAttribute("accept",".csv,.kml"),f.style.display="none",f.addEventListener("change",h),f.click(),p=f}else console.error("The File APIs are not fully supported in this browser.")}function u(e){e=e||window;var t=e.document.body;if(!e.newDialogsObserver&&t){var o=r(function(e,t){Y.Global.fire("Dialog:edit",{context:e})},200,!1);e.newDialogsObserver=new MutationObserver(function(e){e.forEach(function(e){if(e.target)e.target.className&&e.target.className.indexOf&&e.target.className.indexOf("BlockEditorContainer-desktop-dialogContainer")>-1?o(e.target,4):e.target.dataset&&"block-editor-container"==e.target.dataset.test&&o(e.target,5);else if(e.addedNodes&&e.addedNodes[0]){var t=Array.prototype.slice.call(e.addedNodes[0].childNodes);if(e.addedNodes[0].className&&e.addedNodes[0].className.length)e.addedNodes[0].className.indexOf("BlockEditorContainer-desktop-dialogContainer")>-1&&o(e.addedNodes[0],1);else if(t[0]&&t[0].childNodes){var r=Array.prototype.slice.call(t[0].childNodes);r.forEach(function(e){e.className&&e.className.indexOf&&e.className.indexOf("BlockEditorContainer-desktop-dialogContainer")>-1&&o(e,2)})}}})}),e.newDialogsObserver.observe(t,{childList:!0,subtree:!0,attributes:!0})}}function g(t){if(t.context){var r=e(t.context),o=r&&r.pendingProps&&r.pendingProps||r&&r.props;if(r&&o&&o.config&&o.config.uiSchema&&o.blockTypeName&&"map"==o.blockTypeName){var i=!1,a=function(e){var t=e&&e.getAttrs(),r=e&&t&&t.snazzyData&&t.snazzyUrl&&t.snazzyName,i=o.config.uiSchema[0].properties.children[1].properties.children;for(let o=0;o<i.length;o++){let l=i[o];if("#/style"==l.$mapping)if(r){if(l.properties.enum&&-1==l.properties.enum.indexOf(99)&&l.properties.enum.push(99),l.properties.enumAnnotation){var a=!0;l.properties.enumAnnotation.forEach(function(e){e.label==t.snazzyName?a=!1:e.label!==t.snazzyName&&"https://snazzymaps.com/apple-icon-57x57.png"==e.icon&&(e.label=t.snazzyName,a=!1)}),a&&l.properties.enumAnnotation.push({label:t.snazzyName,showLabel:!0,icon:"https://snazzymaps.com/apple-icon-57x57.png"})}e&&(t.style=99,e.setAttrs(t))}else{if(l.properties.enum&&l.properties.enum.indexOf(99)>-1&&l.properties.enum.slice(l.properties.enum.indexOf(99),1),l.properties.enumAnnotation){var n=!1;l.properties.enumAnnotation.forEach(function(e,r){e.label==t.snazzyName&&(n=r)}),n&&l.properties.enumAnnotation.slice(n,1)}e&&99==t.style&&(t.style=2,e.setAttrs(t))}}};try{var n=o.host.get("model");n&&(i=n&&n.getAttrs&&n.getAttrs(),n._onChange||(n._onChange=n.after("change",function(e,t){if(n=e.target,e.changed&&(e.changed.snazzyData&&a(e.target),e.changed["marker-image"]))if("string"==typeof e.changed["marker-image"].newVal){var r=e.changed["marker-image"].newVal;fetch("/api/content-items/"+r).then(function(e){return e.json()}).then(function(e){if(e&&e.systemDataId){var t=e.originalSize.split("x");n.set("markerImage",e.assetUrl),n.set("markerImageHeight",t[1]),n.set("markerImageWidth",t[0])}})}else n.set("markerImage",""),n.set("markerImageHeight",""),n.set("markerImageWidth","");b()})));var l=function(){try{var r=t.context.querySelectorAll('[role="tablist"] label'),i=t.context.querySelector('div[class*="Transition-panel-"] > div'),l=e(i,"not_child");if(i&&l.updater&&l.updater.enqueueForceUpdate){try{o.config.uiSchema&&(l.props.context.configurations.default.uiSchema=o.config.uiSchema)}catch(e){console.log("Can not apply config to tabs and render",e)}l.updater.enqueueForceUpdate(l),setTimeout(function(){r=i.querySelectorAll('[role="tablist"] [role="tab"]'),r[2]&&r[2].click()},300)}else r[1]&&(r[1].click(),console.log("Updated Settings Panel with labels"))}catch(e){console.log(e)}a(n)},p=(o.config.uiSchema,{type:"group",properties:{label:"Multiple",children:[{type:"spacer",properties:{gridMultiplier:2}},{type:"group",$conditional:{$if:{$pointer:"#/multipleLocations",$comparator:{eq:!0}},$then:{}},properties:{children:[{type:"context",properties:{description:'Make sure your <b>*.CSV</b> file has comma "," as delimiter. See file example on <a target="_blank" href="https://drive.google.com/file/d/1ENFuTB-3OjEywm5NYKtEUlS21rbUF13Y/view?usp=sharing">Google Drive</a><br/><b>Google KML</b> files also supported, only titles and coordinates imported.'}},{type:"button",properties:{label:"Import *.CSV/*.KML",className:"input-button",alignment:"center",onClick:function(e){m("new-dialog",r,t.context,e,this)}}},{type:"group",$conditional:{$if:{$pointer:"#/csvData",$comparator:{eq:null}},$then:{type:"hidden"}},properties:{children:[{type:"button",properties:{label:"Export CSV",className:"input-button",onClick:function(e,t){try{var o=(r.props||r.pendingProps).host.get("model").get("csvData")||"Nothing there",i=document.body.querySelector(".csvExportLink");i&&document.body.removeChild(i);var a=window.document.createElement("a");a.className="csvExportLink",a.setAttribute("href","data:text/csv; charset=utf-8,"+encodeURIComponent(o)),a.setAttribute("download","Map.csv"),document.body.appendChild(a),a.click()}catch(e){console.log(e)}}}},{type:"button",className:"input-button",properties:{label:"Clear CSV",description:"",onClick:function(e,o){s("new-dialog",r,t.context),console.log("Reset Model CSV data")}}}]}},{type:"textarea",properties:{className:"mapCSVData",description:""},$mapping:"#/csvData"}]}},{type:"spacer",properties:{gridMultiplier:2}},{type:"boolean",properties:{label:"Use Collection Locations",showSortButtons:!0,description:"Select collection with Locations articles/images inside"},$sideEffects:[{$if:{anyOf:[{"#/multipleLocations":{eq:!0}}]},$then:{set:{"#/csvData":null}}}],trackingId:"multipleLocations",$mapping:"#/multipleLocations"},{type:"spacer",properties:{gridMultiplier:2}},{type:"group",properties:{children:[{type:"disclosure",properties:{label:"Select Collection",detail:{$data:"#/mapCollection/title"},children:[{type:"contentpicker",trackingId:"mapCollection",properties:{showExternalLinks:!0,hidePageFilters:!1,typeNames:["blog","events","gallery","products","events-stacked","blog-side-by-side","blog-single-column","blog-masonry","blog-alternating-side-by-side","blog-basic-grid"]},$mapping:{collectionId:"#/mapCollection/collectionId",filters:"#/mapCollection/filter",collectionType:"#/mapCollection/collectionType",urlId:"#/mapCollection/urlId",title:"#/mapCollection/title",typeName:"#/mapCollection/typeName"}}]}}]},$conditional:{$if:{"#/multipleLocations":{ne:!0}},$then:{type:"hidden"}}},{type:"spacer",properties:{gridMultiplier:2}},{type:"dropdownselect",properties:{label:"Upcoming or Past",description:"If using Events as a source, select what events to show",defaultValue:"upcoming",enum:["upcoming","past","all"],enumAnnotation:[{label:"Upcoming"},{label:"Past"},{label:"All"}]},trackingId:"eventsFactor",$mapping:"#/eventsFactor"},{type:"spacer",properties:{gridMultiplier:2}},{type:"boolean",properties:{label:"Enable items caching, improve next loading time",description:"This will cache loaded items for 10 minutes."},trackingId:"useSessionCache",$mapping:"#/useSessionCache"},{type:"spacer",properties:{gridMultiplier:2}},{type:"boolean",properties:{label:"Use Squarewebsites.org Server SPEED",description:"This will cache your collection json data on our server and make it faster accessible for all your users.",defaultValue:!1},trackingId:"useSQSProxy",$mapping:"#/useSQSProxy"},{type:"spacer",properties:{gridMultiplier:2}},{type:"range",properties:{label:"Cache time, minutes",description:"Time to request new cached version from squarewebsites.org",min:10,max:60,step:1},$conditional:{$if:{$pointer:"#/useSQSProxy",$comparator:{ne:!0}},$then:{type:"hidden"}},$mapping:"#/proxyCacheTime"},{type:"spacer",properties:{gridMultiplier:2}},{type:"boolean",properties:{label:"Enable Smart Markers",description:"This allows to show markers with the SAME Location in a Circle. Popups will be showed ONLY by click, not on hover. Show all popups on init will not works also."},trackingId:"omsEnable",$mapping:"#/omsEnable"},{type:"spacer",properties:{gridMultiplier:2}},{type:"boolean",properties:{label:"Enable marker Clusterer to handle a big markers number."},trackingId:"enableClusters",$mapping:"#/enableClusters"},{type:"group",properties:{children:[{type:"textarea",properties:{label:"Clusters images folder url.",placeholder:"https://assets.squarewebsites.org/sqs-map-utils/markerclusterer/m",description:"You may leave here default https://assets.squarewebsites.org/sqs-map-utils/markerclusterer/m or set you own folder url with m1.png-m5.png images"},trackingId:"clustersImagesFolder",$mapping:"#/clustersImagesFolder"},{type:"spacer",properties:{gridMultiplier:2}},{type:"range",properties:{label:"Set Clusters Distance",description:"The bigger value is, more distant from each other markers pushed to clusters.",min:1,max:400,step:1},$mapping:"#/clustersGrid"}]},$conditional:{$if:{allOf:[{"#/enableClusters":{ne:!0}}]},$then:{type:"hidden"}}},{type:"spacer",properties:{gridMultiplier:2}},{type:"textarea",properties:{label:"Custom Url (JSON or CSV)",description:'Make sure response is in JSON or CSV format plugin can handle.<br/><ol style="padding-left: 12px"><li>Use Squarespace JSON or CSV from the <b><a target="_blank" href="https://drive.google.com/file/d/1ENFuTB-3OjEywm5NYKtEUlS21rbUF13Y/view?usp=sharing">Google Drive</a></b>.</li><li>You may also fetch several Squarespace collections, set their urls here and separate with vertical bar character |, like <b>/coll-1|/coll-2|/coll-3</b>.</li><li>You may create Google Sheet following format from 1), publish it as CSV and paste that shared link into this field.</li></ol>'},$mapping:"#/customItemsUrl"},{type:"spacer",properties:{gridMultiplier:2}}]},trackingId:"multiple-tab"}),c={type:"group",properties:{label:"Markers",children:[{type:"spacer",properties:{gridMultiplier:2}},{type:"boolean",properties:{defaultValue:!0,label:"Use Optimized Markers",description:"<b>Keep checked for big markers number</b> (all markers are one element in DOM).</br><b>If not checked,</b> markers are separate elements in DOM - usefull if you <b>do not want them repeat when map continents repeated on small zoom.</b>"},trackingId:"useOptimizedMarkers",$mapping:"#/useOptimizedMarkers"},{type:"spacer",properties:{gridMultiplier:2}},{type:"dropdownselect",properties:{label:"Map Markers Position",description:"<b style='color:#000'>Current</b> - Drag the map and that map position will be used.</br><b style='color:#000'>Fit Bounds</b> - If multiple markers, map will adjust zoom level to show them all if possible. Disable if you want specify static zoom level.</br><b style='color:#000'>Just Center</b> - Just finds the center of all markers and center the map, adjust zoom level manually.",defaultValue:"fitBounds",enum:["none","fitBounds","center"],enumAnnotation:[{label:"Current"},{label:"Fit Bounds"},{label:"Just Center"}]},$mapping:"#/mapPositionFactor"},{type:"spacer",properties:{gridMultiplier:2}},{type:"boolean",properties:{label:"Return to init Map position",description:"If checked, Map will return to init Map position after closing Popup or after window Resize"},trackingId:"followMapPositionSet",$mapping:"#/followMapPositionSet"},{type:"spacer",properties:{gridMultiplier:2}},{type:"boolean",properties:{label:"Click On Marker forwards to url.",description:"This will be internal item url or may be external or custom url from Source URL or Clickthrough URL."},trackingId:"markerClickable",$mapping:"#/markerClickable"},{type:"spacer",properties:{gridMultiplier:2}},{type:"boolean",properties:{label:'Respect "Link Post Title to Source URL"',description:'If checked, Source Url will be set only if you have "Link Post Title to Source URL" checked in Post setting'},trackingId:"respectSourceUrlCheckbox",$mapping:"#/respectSourceUrlCheckbox"},{type:"spacer",properties:{gridMultiplier:2}},{type:"dropdownselect",properties:{label:"Show Title in Map near marker",description:"Title is shown as label on Map, it has .marker-label classname, so you may easy adjust with own CSS rules.",defaultValue:"none",enum:["no","top","bottom"],enumAnnotation:[{label:"No"},{label:"Top"},{label:"Bottom"}]},trackingId:"showMarkerLabel",$mapping:"#/showMarkerLabel"},{type:"spacer",properties:{gridMultiplier:2}},{type:"range",$conditional:{$if:{"#/showMarkerLabel":{eq:"no"}},$then:{type:"hidden"}},properties:{label:"Marker Label Font Size",description:"Set the marker label font size in px",min:1,max:50,step:1},$mapping:"#/markerLabelFontSize"},{type:"spacer",properties:{gridMultiplier:2}},{type:"string",$conditional:{$if:{"#/showMarkerLabel":{eq:"no"}},$then:{type:"hidden"}},properties:{label:"Marker Label Color",description:"Use any CSS-valid color string.",placeholder:"#000000"},$mapping:"#/markerLabelColor"},{type:"spacer",properties:{gridMultiplier:2}},{type:"dropdownselect",properties:{label:"Marker Info Popup activating",description:"Select some option to show popups on: Click, Mouseover or just on Map init.",defaultValue:"none",enum:["none","click","mouseover","showOnInit"],enumAnnotation:[{label:"None"},{label:"Click"},{label:"Mouseover"},{label:"Show On Init"}]},trackingId:"markerInfoFactor",$mapping:"#/markerInfoFactor"},{type:"spacer",properties:{gridMultiplier:2}},{type:"boolean",properties:{label:"Click On Map closes opened Popup",description:"When you click Map any opened Info Popup will be closed"},$mapping:"#/mapClickInfoClose"},{type:"spacer",properties:{gridMultiplier:2}},{type:"group",$conditional:{$if:{"#/markerInfoFactor":{eq:"none"}},$then:{type:"hidden"}},properties:{children:[{type:"dropdownselect",properties:{label:"Where to place popup",description:"Select where to place popup: top, bottom, left or right.",defaultValue:"top",enum:["top","bottom","left","right"],enumAnnotation:[{label:"Top"},{label:"Bottom"},{label:"Left"},{label:"Right"}]},trackingId:"popupPosition",$mapping:"#/popupPosition"},{type:"spacer",properties:{gridMultiplier:2}},{type:"range",properties:{min:100,max:500,step:1,label:"Marker Popup Width",description:"Set the popup width in px"},$mapping:"#/markerInfoWidth"}]}},{type:"boolean",properties:{label:"Build Markers Info Panel.",description:"Items info will be NOT popups, but as list in Panel."},trackingId:"buildInfoOutside",$mapping:"#/buildInfoOutside"},{type:"spacer",properties:{gridMultiplier:2},$conditional:{$if:{$pointer:"#/buildInfoOutside",$comparator:{ne:!0}},$then:{type:"hidden"}}},{type:"boolean",properties:{label:"Show Outside Panel initially",description:"If checked - show panel on Map init"},$conditional:{$if:{$pointer:"#/buildInfoOutside",$comparator:{ne:!0}},$then:{type:"hidden"}},trackingId:"showPanel",$mapping:"#/showPanel"},{type:"spacer",properties:{gridMultiplier:2},$conditional:{$if:{$pointer:"#/buildInfoOutside",$comparator:{ne:!0}},$then:{type:"hidden"}}},{type:"boolean",properties:{label:"Popover Content",description:"If checked - show the same content you set to show outside, not checked - show only title."},$conditional:{$if:{$pointer:"#/buildInfoOutside",$comparator:{ne:!0}},$then:{type:"hidden"}},trackingId:"sameAsBuildOutside",$mapping:"#/sameAsBuildOutside"},{type:"spacer",properties:{gridMultiplier:2},$conditional:{$if:{$pointer:"#/buildInfoOutside",$comparator:{ne:!0}},$then:{type:"hidden"}}},{type:"boolean",properties:{label:"Hide Popover on Map",description:"If checked - only outside content will be showed, no popover on Map. Marker will get animation instead."},$conditional:{$if:{$pointer:"#/buildInfoOutside",$comparator:{ne:!0}},$then:{type:"hidden"}},trackingId:"hideMapInfo",$mapping:"#/hideMapInfo"},{type:"spacer",properties:{gridMultiplier:2}},{type:"dropdownselect",$conditional:{$if:{$pointer:"#/buildInfoOutside",$comparator:{ne:!0}},$then:{type:"hidden"}},properties:{label:"Where to place outside panel",description:"Select where to place map panel with items: Left, Right, Top, Bottom or Under Map",defaultValue:"left",enum:["top","bottom","left","right","relative"],enumAnnotation:[{label:"Top"},{label:"Bottom"},{label:"Left"},{label:"Right"},{label:"Under Map"}]},trackingId:"placeOutside",$mapping:"#/placeOutside"},{type:"spacer",properties:{gridMultiplier:2}},{type:"disclosure",properties:{label:"Show Info",description:"Select what Info to show in Popups (or rendered items): Titles, Excerpts, Images, Location...",children:[{type:"boolean",properties:{label:"Show Item Title"},trackingId:"showTitle",$mapping:"#/showTitle"},{type:"spacer",properties:{gridMultiplier:2}},{type:"boolean",properties:{label:"Disable Title Link Click",description:"Will not react on title clicking"},$conditional:{$if:{$pointer:"#/showTitle",$comparator:{ne:!0}},$then:{type:"hidden"}},trackingId:"disableTitleClick",$mapping:"#/disableTitleClick"},{type:"spacer",$conditional:{$if:{$pointer:"#/showTitle",$comparator:{ne:!0}},$then:{type:"hidden"}},properties:{gridMultiplier:2}},{type:"boolean",properties:{label:"Show Item Date"},trackingId:"showDate",$mapping:"#/showDate"},{type:"spacer",properties:{gridMultiplier:2}},{type:"dropdownselect",$conditional:{$if:{$pointer:"#/showDate",$comparator:{ne:!0}},$then:{type:"hidden"}},properties:{label:"Date render option",description:"If Fast selected - we build dates using <b>toLocaleTimeString()</b>, if Slow - we fetch dates from events pages.<br/><b>So DO NOT use Slow for a lot of events and Build Outside panel option.</b>",defaultValue:"fast",enum:["fast","slow"],enumAnnotation:[{label:"Fast"},{label:"Slow"}]},trackingId:"dateWay",$mapping:"#/dateWay"},{type:"spacer",$conditional:{$if:{$pointer:"#/showDate",$comparator:{ne:!0}},$then:{type:"hidden"}},properties:{gridMultiplier:2}},{type:"boolean",properties:{label:"Show Item Excerpt"},trackingId:"showExcerpt",$mapping:"#/showExcerpt"},{type:"spacer",properties:{gridMultiplier:2}},{type:"boolean",properties:{label:"Show Item Image"},trackingId:"showImage",$mapping:"#/showImage"},{type:"spacer",properties:{gridMultiplier:2}},{type:"boolean",properties:{label:"Show Item Location/Address"},trackingId:"showLocationInfo",$mapping:"#/showLocationInfo"},{type:"spacer",properties:{gridMultiplier:2}},{type:"boolean",properties:{label:"Show Item Categories"},trackingId:"showCats",$mapping:"#/showCats"},{type:"spacer",properties:{gridMultiplier:2}},{type:"boolean",properties:{label:"Show Item Tags"},trackingId:"showTags",$mapping:"#/showTags"}]}},{type:"spacer",properties:{gridMultiplier:2}},{type:"disclosure",properties:{label:"Marker (Pins) Icons",description:"upload main marker image and define different images based on items categories.",children:[{type:"spacer",properties:{gridMultiplier:1}},{type:"imageuploaderwithlicensedassets",properties:{cancelable:!0,imageDestination:"page-section-background-image",label:"Marker Image",description:"Main Marker image, applied as general marker if you are not using <b>Categories Markers</b>"},$mapping:"#/marker-image"},{type:"spacer",properties:{gridMultiplier:2}},{type:"range",properties:{label:"Marker Image Scale",description:"",min:.05,max:3,step:.01},$mapping:"#/markerImgScale"},{type:"spacer",properties:{gridMultiplier:2}},{type:"dropdownselect",properties:{label:"Markers Animation",description:"Select from built-in Google Animations.</br> If having Clustering or Smart Markers enabled - animation may not work as you expect, because in that case several markers appears in one layer.",defaultValue:"NONE",enum:["NONE","BOUNCE","DROP","BB","xB"],enumAnnotation:[{label:"None"},{label:"Bounce"},{label:"Drop"},{label:"Small Drop"},{label:"Waving Small Drop"}]},trackingId:"markersAnimation",$mapping:"#/markersAnimation"},{type:"spacer",properties:{gridMultiplier:2}},{type:"range",properties:{label:"Animation stagger, ms",description:"Delay between multiple markers animations, in ms",min:0,max:200,step:1},$conditional:{$if:{$pointer:"#/markersAnimation",$comparator:{eq:"NONE"}},$then:{type:"hidden"}},trackingId:"markersAnimationStagger",$mapping:"#/markersAnimationStagger"},{type:"spacer",$conditional:{$if:{$pointer:"#/markersAnimation",$comparator:{eq:"NONE"}},$then:{type:"hidden"}},properties:{gridMultiplier:2}},{type:"textarea",properties:{label:"Categories Markers (Pins)",description:"If you follow the format, you may show different markers for each item category.<br/>You may use own hosting for image files or use Squarespace Custom Styles uploader or Link files uploader<br/><b>Store</b> - this is a Category of item.<br/><b>/s/store.png</b> - this my image url, it was uploaded to /s/ folder with Link<br/><b>64x64</b> - this is a dimension of image file, really no need to go more than 64px",placeholder:"--Store|/s/store.png|64x64"},$mapping:"#/catsMarkers"}]}}]},trackingId:"markers-tab"},u={type:"group",properties:{children:[{type:"string",properties:{inline:!1,label:"Set Snazzy Map public url there",description:'This will try to fetch Snazzy style and apply to your Map.<br/>Search the style you like there <a href="https://snazzymaps.com/explore">https://snazzymaps.com/explore</a>',placeholder:"https://snazzymaps.com/style/14889/flat-pale"},$mapping:"#/snazzyUrl"},{type:"hidden",properties:{placeholder:"Style Name",label:"Snazzy Style"},$mapping:"#/snazzyName"},{type:"button",properties:{label:"Click to Fetch Snazzy Style",description:"On click this will try to fetch style from Snazzy and you will see the result.<br/>Not all styles may work, so try to find another similar if something not work",className:"input-button",alignment:"center",onClick:function(e,o){d(r,t.context)}}},{type:"hidden",properties:{placeholder:"Style colors array"},$mapping:"#/snazzyData"},{type:"spacer",properties:{gridMultiplier:2}},{type:"range",properties:{label:"Set Map Zoom Level",description:"Works if you selected Current Map position",min:1,max:21,step:1},$mapping:"#/zoomControl"},{type:"spacer",properties:{gridMultiplier:2}},{type:"textarea",properties:{label:"Set Minimum and Maximum Zoom Levels",description:"Please follow the format <b>min|max</b>, default value is <b>1|21</b>",placeholder:"1|21",default:"1|21"},$mapping:"#/minMaxZoom"},{type:"spacer",properties:{gridMultiplier:2}},{type:"dropdownselect",properties:{label:"Enable User Location Button",description:"<b>Will work for Map with multiple markers only.</b>",defaultValue:"left",enum:["none","LEFT_TOP","TOP_CENTER","RIGHT_TOP","LEFT_CENTER","RIGHT_CENTER","LEFT_BOTTOM","BOTTOM_CENTER","RIGHT_BOTTOM"],enumAnnotation:[{label:"None"},{label:"Left Top"},{label:"Top Center"},{label:"Right Top"},{label:"Left Center"},{label:"Right Center"},{label:"Left Bottom"},{label:"Bottom Center"},{label:"Right Bottom"}]},trackingId:"showUserLocation",$mapping:"#/showUserLocation"},{type:"spacer",properties:{gridMultiplier:2}},{type:"dropdownselect",properties:{label:"Gestures handling",description:"<b>Select how Map reacts on gestures, leave <i>Auto</i> if not sure</b>",defaultValue:"auto",enum:["none","greedy","cooperative","auto"],enumAnnotation:[{label:"None, disables panning, pinching, dragging"},{label:"Greedy, map always pans"},{label:"Cooperative, (the ctrl or âŒ˜ key) on desktop"},{label:"Auto, either Cooperative or Greedy"}]},trackingId:"gestureHandling",$mapping:"#/gestureHandling"},{type:"spacer",properties:{gridMultiplier:2}},{type:"boolean",properties:{label:"Disable POI (point of interest) clicks",description:"If enabled, clicking on stations, museums ...etc icons will not show the info popup."},$mapping:"#/disablePOIClick"}]}};if(o.config.uiSchema[0].properties.children[2]=p,o.config.uiSchema[0].properties.children[3]=c,o.config.uiSchema[0].properties.children[1].properties.children){var g=Y.Squarespace.Damask.ContextGlobals.fromFrame("window.__customMapStyles");o.config.uiSchema[0].properties.children[1].properties.children.forEach(function(e,t){if(e.$mapping&&"#/style"==e.$mapping){if(g){g=g.slice(0);var r=e.properties.enum,i=e.properties.enumAnnotation;r.length>6&&(i.slice(0,6),r.slice(0,6)),r.length<7&&g.forEach(function(e){i.push({label:e.label,showLabel:!0,icon:e.icon}),r.push(e.value)}),!0}"group"!==o.config.uiSchema[0].properties.children[1].properties.children[t+1].type?(o.config.uiSchema[0].properties.children[1].properties.children.splice(t+1,0,u),!0):o.config.uiSchema[0].properties.children[1].properties.children[t+1]=u}})}var h={markerInfoWidth:300,zoomControl:12,useOptimizedMarkers:!0,mapPositionFactor:"fitBounds",minMaxZoom:"1|21",csvData:null,showUserLocation:"none",gestureHandling:"auto",markerImgScale:1,clustersImagesFolder:"https://assets.squarewebsites.org/sqs-map-utils/markerclusterer/m",clustersGrid:50,followMapPositionSet:!0,placeOutside:"left",markerInfoFactor:"click",popupPosition:"top",buildInfoOutside:!1,showPanel:!1,hideMapInfo:!1,useSessionCache:!1,useOptimizedMarkers:!0,showTitle:!0,showExcerpt:!0,showImage:!0,proxyCacheTime:10,dateWay:"fast",showMarkerLabel:"no",markersAnimation:"NONE",markersAnimationStagger:60,markerLabelColor:"#000000",markerLabelFontSize:"14"},f=!1;for(var y in h)h.hasOwnProperty(y)&&(o.initialValue&&!o.initialValue.hasOwnProperty(y)&&(o.initialValue[y]=h[y]),i&&!i.hasOwnProperty(y)&&(i[y]=h[y],f=!0));i&&f&&n.setAttrs(i),l()}catch(e){console.log("Smth with dialog or uiSchema is not accessible",e)}}}}function h(){}function y(){window.advanced_maps_inited=!0,h(),Y.Global.after("Dialog:edit",g),u(window.top),a(window.top);try{a(Y.Squarespace.Damask.ContextGlobals.fromFrame("window")._node)}catch(e){console.log(e)}Y.Squarespace.Block&&Y.Squarespace.Block.ModelEditorDialog&&Y.Squarespace.Block.ModelEditorDialog.Map&&(Y.Squarespace.Block.ModelEditorDialog.Map.prototype._toggleTerrainField=function(){try{var e=this.get("dialog"),t=e.getField("terrain");e&&t&&t.show()}catch(e){console.log(e)}}),Y.one("#sqs-site-frame").on("load",function(e){a(Y.Squarespace.Damask.ContextGlobals.fromFrame("window")._node)}),Y.Global.on("SQSLayout:edit",function(){b()});var e=Y.Squarespace.Damask.ContextGlobals.fromFrame("AdvancedMapsStyles");e&&i(e,"maps-utils",window.top),o("../assets.squarewebsites.org/sqs-map-utils/maps-admin-styles.min.css","maps-admin-styles"),w&&(window.clearInterval(w),w=null),console.log("Advanced Maps Admin init")}String.prototype.csvToArray=function(e){var t=function(e){var t=[",",";","|","\t"],r=t.map(function(t){return e.indexOf(t)}).reduce(function(e,t){return-1===e||-1!==t&&t<e?t:e});return e[r]||","},r={fSep:",",rSep:"\n",quot:'"',head:!1,trim:!1};if(e)for(var o in r)e[o]||(e[o]=r[o]);else e=r;var i=[[""]];e.fSep=t(this)||",",this.indexOf("\r\n")>-1&&(e.rSep="\r\n");for(var a=f=p=q=0;p<this.length;p++)switch(c=this.charAt(p)){case e.quot:q&&this.charAt(p+1)==e.quot?(i[a][f]+=e.quot,++p):q^=1;break;case e.fSep:q?i[a][f]+=c:(e.trim&&(i[a][f]=i[a][f].replace(/^\s\s*/,"").replace(/\s\s*$/,"")),i[a][++f]="");break;case e.rSep.charAt(0):q||e.rSep.charAt(1)&&(!e.rSep.charAt(1)||e.rSep.charAt(1)!=this.charAt(p+1))?i[a][f]+=c:(e.trim&&(i[a][f]=i[a][f].replace(/^\s\s*/,"").replace(/\s\s*$/,"")),i[++a]=[""],i[a][f=0]="",e.rSep.charAt(1)&&++p);break;default:i[a][f]+=c}return e.head&&i.shift(),i[i.length-1].length<i[0].length&&i.pop(),i};var b=r(function(e){Y.Global.fire("custom-map-init")},700,!1),w=!1;window.top.__sqs_advanced_maps_inited||window.advanced_maps_inited?console.log("Seems Advanced Maps Admin already initialized."):-1!=document.body.className.indexOf("sqs-frame-loaded")||w?y():w=setInterval(function(){var e=document.body.className.indexOf("sqs-frame-loaded")>-1;e&&y()},100)}();